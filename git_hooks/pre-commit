#!/bin/bash

# Pre-commit hook to run unit tests and lint checks
# This hook prevents commits if tests fail or linting fails

set -e

echo "Running pre-commit checks..."
echo ""

# Colors for output (optional, will work if terminal supports it)
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to print error and exit
error_exit() {
    echo -e "${RED}❌ Pre-commit hook failed!${NC}"
    echo -e "${RED}Commit aborted.${NC}"
    exit 1
}

# Function to print success
success_msg() {
    echo -e "${GREEN}✅ $1${NC}"
}

# Run linting
echo -e "${YELLOW}Running ESLint...${NC}"
if npm run lint; then
    success_msg "Linting passed"
else
    echo -e "${RED}Linting failed. Please fix the errors before committing.${NC}"
    error_exit
fi

echo ""

# Run unit tests
echo -e "${YELLOW}Running unit tests...${NC}"
if npm test; then
    success_msg "All tests passed"
else
    echo -e "${RED}Tests failed. Please fix the failing tests before committing.${NC}"
    error_exit
fi

echo ""
success_msg "All pre-commit checks passed!"
echo ""

exit 0

